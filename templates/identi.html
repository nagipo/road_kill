<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=
    , initial-scale=1.0">
    <title>鑑定</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
   

    <style>
      
        body{
            background-color: antiquewhite;
            
        }
        .wait{
          display: none;
        }
        .fixed-top>div {
            display: inline-block;
        }
        #navbarNav>ul>li:hover{
            background-color: rgb(212, 186, 16);
        }
        .sp_name{
            font-style:italic
        }
        
    </style>
</head>

<body>
    <div class="container-fluid px-0 wait d-flex" >
        <div  class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-sm">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="sign_in">登入</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <label for="key_acount">帳號:</label>
                    <input name="key_acount" id='account' type="text" name="ac"><br><br>
                    <label for="key_password" >密碼:</label>
                    <input name="key_password" id="password" name= type="text">
                </div>
                <div class="modal-footer">
                  <a  href="/forget_password" type="button" class="btn btn-secondary" >忘記密碼</a>
                  <button type="button" class="btn btn-warning" id="go_sign_in">確定</button>
                </div>
              </div>
            </div>
          </div>
        <div class=" row fixed-top" style="background-image:url(/static/img/header_bg.jpg) ;">
          
            <div class="d-flex justify-content-center col-12">
                <div>
                    <a href="/" class="text-decoration-none text-light text-center">
                        <span class="h1 d-block ">陸域野生動物目擊回報</span>
                        
                    </a>
    
                </div>
                <div class="align-self-center ms-5">
                    <input type="text"  placeholder="搜尋" class="form-control">

                </div>
                <button hidden id="go_log_out" class="logging btn btn-dark  ms-3  align-self-center text-nowrap" style="height: 35px; width:70px"  >登出</button>
                <button id="about_me" hidden class="logging btn btn-dark  ms-3  align-self-center text-nowrap" style="height: 35px; width:70px" ></button>

                <button  class="unlogging btn btn-dark  ms-3  align-self-center text-nowrap" style="height: 35px; width:70px" data-bs-toggle="modal" data-bs-target="#exampleModal">登入</button>
                <a href="/sign_up" id="sign_up" class="unlogging btn btn-dark ms-2 align-self-center text-nowrap" style="height: 35px; width:70px">註冊</a>
                <button style="height: 35px;width: 35px;" class="navbar-toggler ms-3 ms-md-5  align-self-center d-lg-none" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
                  <span ><img src="/static/img/list_grey.svg" style="height: 35px;width: 35px;"></span>
                </button>
                
            </div>
            <div class="container">
               
                <nav class="navbar navbar-expand-lg navbar-dark pb-0">
                    <div class="container-fluid p-0">
                        
                        
                        
                            <div class="collapse navbar-collapse m-0 pb-0 navbar-brand" id="navbarNav">
                                <ul class="navbar-nav bg-warning  justify-content-center col-12" >
                                  <li class="nav-item"><a href="/" class="nav-link be_disable" disabled style="color:black ;">首頁</a></li>
                                    <li class="nav-item"><a href="/upload" class="nav-link be_disable" disabled style="color:black ;">目擊目擊回報</a></li>
                                    <li class="nav-item"><a href="/identi" class="nav-link be_disable" disabled  style="color:black ;">物種鑑定</a></li>
                                    <!-- <li class="nav-item"><a href="./identification_test.html" class="nav-link be_disable" disabled  style="color:black ;">物種鑑定測驗</a></li> -->
                                    <li class="nav-item"><a href="/ambulance" class="nav-link" style="color:black ;">救傷通報</a></li>

                                    <!-- <li class="nav-item"><a href="./data.html" class="nav-link" style="color:black ;">資料查詢</a></li>
                                    <li class="nav-item"><a href="./text.html" class="nav-link" style="color:black ;">訊息專區</a></li> -->
                                </ul>
                            </div>
                            
                    </div>
                    
                </nav>
               
            </div>
           
           
        </div>

        
        
        
        </div>
        <div style="height: 150px;"></div>
        
        <div  class="modal fade" id="identi" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-md">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="sign_in">鑑定</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body ">
                   <img id="identi_img" src="" style="object-fit: contain; width:50%; margin-left :25%;" alt="">
                    <div class="mt-3" style="margin-left :10%">
                    <p id="first_identi" class="h4">初判:</p>
                    <label class="h4" for="challenge" >鑑定:</label>
                    <input name="challenge" id="challenge"  type="text">
                    </div>
                </div>
                <div class="modal-footer">
                  
                  <button type="button" class="btn btn-warning" id="identi_sub">提交</button>
                </div>
              </div>
            </div>
          </div>

        <div class="d-flex justify-content-center ">
            <table class="table bg-light" style="width: 60%; ">
                <thead>
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">初步鑑定</th>
                    <th scope="col">地點</th>
                    <th scope="col"></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th scope="row">1</th>
                    <td class="sp_name">Eutropis multifasciata</td>
                    <td class="location">台中市</td>
                    <td class="td_b"><button disabled id="b1" class="b btn btn-primary" data-bs-toggle="modal" data-bs-target="#identi">鑑定</button></td>
                  </tr>
                  <tr>
                    <th scope="row">2</th>
                    <td class="sp_name"></td>
                    <td class="location"></td>
                    <td><button disabled id="b2" class="b btn btn-primary" data-bs-toggle="modal" data-bs-target="#identi">鑑定</button></td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td class="sp_name"></td>
                    <td class="location"></td>
                    <td><button disabled id="b3" class="b btn btn-primary" data-bs-toggle="modal" data-bs-target="#identi">鑑定</button></td>
                  </tr>
                  <tr>
                    <th scope="row">4</th>
                    <td class="sp_name"></td>
                    <td class="location"></td>
                    <td><button disabled id="b4" class="b btn btn-primary" data-bs-toggle="modal" data-bs-target="#identi">鑑定</button></td>
                  </tr>
                  <tr>
                    <th scope="row">5</th>
                    <td class="sp_name"></td>
                    <td class="location"></td>
                    <td><button disabled id="b5" class="b btn btn-primary" data-bs-toggle="modal" data-bs-target="#identi">鑑定</button></td>
                  </tr>
                </tbody>
              </table>

        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.5/dist/umd/popper.min.js"
    integrity="sha384-Xe+8cL9oJa6tN/veChSP7q+mnSPaj5Bcu9mPX5F5xIGE0DVittaqT5lorf0EI7Vk"
    crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js"
    integrity="sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK"
    crossorigin="anonymous"></script>
    <script
    src="https://code.jquery.com/jquery-3.7.1.js"
    integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
    crossorigin="anonymous"></script>
    
    
    <script> //通用
      $(document).ready(function(){
        $('.wait').removeClass('wait')
        
      })

      

      if(sessionStorage.getItem('login_account')!=null){
        $('.unlogging').prop('hidden',true)
        $('.logging').prop('hidden',false)
        $('.be_disable').prop('disabled',false)
      }

      $('#go_sign_in').on('click' ,async function(){
        let ac_input={
           "account":$('#account').val(),
           "password":$('#password').val()
           };
        let result=await $.ajax({
          type:'post',
          url:'/login',
          data:ac_input,
          success:function(info){
            if (info=='ok'){
              sessionStorage.setItem('login_account',ac_input.account);
              location.reload();
            } else if(data=='password_wrong'){
              alert('密碼錯誤')
            } else if(data=='account_wrong'){
              alert('帳號錯誤')
            } else{
              alert('請重新整理')
            }
          }
          
        }
          
        )
      })

      $('#about_me' ).text(sessionStorage.getItem('login_account'))

      $('#go_log_out').on('click',function(){
        // sessionStorage.setItem('login_account',null);
        sessionStorage.clear();
        location.reload();
        
      })
    </script>

    <script>
      // if($('.b').prop('id'))
      console.log($('.b').prop('id').slice(0,1))
      var id_identi
      $.get(
        '/identi/table',function(info){
          console.log(info)
          var tb_data=info
          console.log(tb_data.upload_id)
          for (let i=0;i<tb_data.length;i++){
        $(`tr:nth-child(${i+1})>.sp_name`).text(tb_data[i].identifi);
        $(`tr:nth-child(${i+1})>.location`).text(tb_data[i].location);
        $(`#b${i+1}`).prop('disabled',false)
        $(`#b${i+1}`).prop('id',`uid_${tb_data[i].upload_id}`)
      }
        }
      )
      
      
      $('.b').on('click',function(){
        console.log($(this).prop('id').slice(4))
        id_identi=$(this).prop('id').slice(4)
        let to_server={'upload_id':$(this).prop('id').slice(4)}
        $.ajax({
          type:'post',
          url:'/identi/img',
          data:to_server,
          success:function(info){
            
            console.log(info)
            $('#identi_img').prop('src',info.photo)
            
            $('#first_identi').text(`初判:${info.identi}`)
            
            
          }
        })
      })

      $('#identi_sub').on('click',function(){
        let to_server_i={
          'challenge':$('#challenge').val(),
          'upload_id':id_identi
      }
        $.ajax({
          type:'post',
          url:'/identi',
          data:to_server_i,
          success:function(info){
            alert(info)
            location.reload()
          }

          
        })
      })
      
    </script>
</body>

</html>